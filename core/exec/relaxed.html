
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Relaxed Memory Model &#8212; WebAssembly 2.0 + Threads (Draft 2023-10-10)</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"maxBuffer": 30720}}</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Binary Format" href="../binary/index.html" />
    <link rel="prev" title="Modules" href="modules.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/webassembly.png" alt="Logo"/>
            </a></p><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syntax/index.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../valid/index.html">Validation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Execution</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="conventions.html">Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="runtime.html">Runtime Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="numerics.html">Numerics</a></li>
<li class="toctree-l2"><a class="reference internal" href="instructions.html">Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Relaxed Memory Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../binary/index.html">Binary Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../text/index.html">Text Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index-types.html">Index of Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index-instructions.html">Index of Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index-rules.html">Index of Semantic Rules</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="../genindex.html">Index</a></li>
    
    <li class="toctree-l1"><a href="../_download/WebAssembly.pdf">Download as PDF</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="relaxed-memory-model">
<span id="relaxed"></span><span id="index-0"></span><h1>Relaxed Memory Model<a class="headerlink" href="#relaxed-memory-model" title="Permalink to this headline">¶</a></h1>
<p>The execution of a WebAssembly program gives rise to a <a class="reference internal" href="#relaxed-trace"><span class="std std-ref">trace</span></a> of events. WebAssembly’s relaxed memory model constrains the observable behaviours of the program’s execution by defining a <a class="reference internal" href="#relaxed-consistent"><span class="std std-ref">consistency</span></a> condition on the trace of events.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A relaxed memory model is necessary to describe the behaviour of programs exhibiting <em>shared memory concurrency</em>.
WebAssembly’s relaxed memory model is heavily based on those of C/C++11 and JavaScript.
The relaxed memory model described here is derived from the following article: <a class="footnote-reference brackets" href="#cite-oopsla2019" id="id1">1</a>.</p>
</div>
<section id="preliminary-definitions">
<span id="relaxed-aux"></span><h2>Preliminary Definitions<a class="headerlink" href="#preliminary-definitions" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}^\ast~\href{../exec/runtime.html#syntax-time}{\mathbin{\mathsf{at}}}~\href{../exec/runtime.html#syntax-time}{\mathit{time}}_p~\href{../exec/runtime.html#syntax-time}{\mathit{time}})     &amp; = &amp; \href{../exec/runtime.html#syntax-time}{\mathit{time}} \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}_p(\href{../exec/runtime.html#syntax-act}{\mathit{act}}^\ast~\href{../exec/runtime.html#syntax-time}{\mathbin{\mathsf{at}}}~\href{../exec/runtime.html#syntax-time}{\mathit{time}}_p~\href{../exec/runtime.html#syntax-time}{\mathit{time}})     &amp; = &amp; \href{../exec/runtime.html#syntax-time}{\mathit{time}}_p \\
&amp;&amp;\\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathsf{rd}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast~\href{../exec/runtime.html#syntax-ord}{\mathsf{notears}}^?)     &amp; = &amp; \href{../exec/runtime.html#syntax-loc}{\mathit{loc}} \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathsf{wr}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast~\href{../exec/runtime.html#syntax-ord}{\mathsf{notears}}^?)     &amp; = &amp; \href{../exec/runtime.html#syntax-loc}{\mathit{loc}} \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathsf{rmw}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}_1}^\ast~{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}_2}^\ast)   &amp; = &amp; \href{../exec/runtime.html#syntax-loc}{\mathit{loc}} \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathsf{wait}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../syntax/values.html#syntax-int}{\mathit{s64}})     &amp; = &amp; \href{../exec/runtime.html#syntax-loc}{\mathit{loc}} \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathsf{woken}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}})     &amp; = &amp; \href{../exec/runtime.html#syntax-loc}{\mathit{loc}} \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathsf{timeout}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}})   &amp; = &amp; \href{../exec/runtime.html#syntax-loc}{\mathit{loc}} \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathsf{notify}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../syntax/values.html#syntax-int}{\mathit{u32}}~\href{../syntax/values.html#syntax-int}{\mathit{u32}})     &amp; = &amp; \href{../exec/runtime.html#syntax-loc}{\mathit{loc}} \\
&amp;&amp;\\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{ord}}(\href{../exec/runtime.html#syntax-act}{\mathsf{rd}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast~\href{../exec/runtime.html#syntax-ord}{\mathsf{notears}}^?)     &amp; = &amp; \href{../exec/runtime.html#syntax-ord}{\mathit{ord}} \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{ord}}(\href{../exec/runtime.html#syntax-act}{\mathsf{wr}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast~\href{../exec/runtime.html#syntax-ord}{\mathsf{notears}}^?)     &amp; = &amp; \href{../exec/runtime.html#syntax-ord}{\mathit{ord}} \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{ord}}(\href{../exec/runtime.html#syntax-act}{\mathsf{rmw}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}_1}^\ast~{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}_2}^\ast)   &amp; = &amp; \href{../exec/runtime.html#syntax-ord}{\mathsf{seqcst}} \\
&amp;&amp;\\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{overlap}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_1, \href{../exec/runtime.html#syntax-act}{\mathit{act}}_2)  &amp; = &amp; (\href{../exec/relaxed.html#relaxed-aux}{\mathrm{range}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_1) \cup \href{../exec/relaxed.html#relaxed-aux}{\mathrm{range}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_2) \neq \epsilon)  \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{same}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_1, \href{../exec/runtime.html#syntax-act}{\mathit{act}}_2) &amp; = &amp; (\href{../exec/relaxed.html#relaxed-aux}{\mathrm{range}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_1) = \href{../exec/relaxed.html#relaxed-aux}{\mathrm{range}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_2)) \\
&amp;&amp;\\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{reading}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})     &amp; = &amp; (\href{../exec/relaxed.html#relaxed-aux}{\mathrm{read}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}) \neq \epsilon) \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{writing}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})     &amp; = &amp; (\href{../exec/relaxed.html#relaxed-aux}{\mathrm{write}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}) \neq \epsilon) \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{susp}}(\href{../syntax/values.html#syntax-int}{\mathit{u32}}, \href{../exec/runtime.html#syntax-act}{\mathsf{wait}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}]~\href{../syntax/values.html#syntax-int}{\mathit{s64}})     &amp; = &amp; \href{../exec/runtime.html#syntax-act}{\mathsf{wait}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}]~\href{../syntax/values.html#syntax-int}{\mathit{s64}} \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{susp}}(\href{../syntax/values.html#syntax-int}{\mathit{u32}}, \href{../exec/runtime.html#syntax-act}{\mathsf{woken}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}])     &amp; = &amp; \href{../exec/runtime.html#syntax-act}{\mathsf{woken}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}] \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{susp}}(\href{../syntax/values.html#syntax-int}{\mathit{u32}}, \href{../exec/runtime.html#syntax-act}{\mathsf{timeout}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}])   &amp; = &amp; \href{../exec/runtime.html#syntax-act}{\mathsf{timeout}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}] \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{susp}}(\href{../syntax/values.html#syntax-int}{\mathit{u32}}, \href{../exec/runtime.html#syntax-act}{\mathsf{notify}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}]~\href{../syntax/values.html#syntax-int}{\mathit{u32}}'~\href{../syntax/values.html#syntax-int}{\mathit{u32}}'')     &amp; = &amp; \href{../exec/runtime.html#syntax-act}{\mathsf{notify}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}]~\href{../syntax/values.html#syntax-int}{\mathit{u32}}'~\href{../syntax/values.html#syntax-int}{\mathit{u32}}'' \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{susp}}(\href{../syntax/values.html#syntax-int}{\mathit{u32}}, \href{../exec/runtime.html#syntax-act}{\mathit{act}})     &amp; = &amp; \epsilon \qquad (\mathrel{\mbox{otherwise}}) \\
&amp;&amp;\\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{read}}(\href{../exec/runtime.html#syntax-act}{\mathsf{rd}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast~\href{../exec/runtime.html#syntax-ord}{\mathsf{notears}}^?)    &amp; = &amp; \href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{read}}(\href{../exec/runtime.html#syntax-act}{\mathsf{rmw}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}_1}^\ast~{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}_2}^\ast)  &amp; = &amp; {\href{../syntax/values.html#syntax-byte}{\mathit{byte}}_1}^\ast \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{read}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})  &amp; = &amp; \epsilon \qquad (\mathrel{\mbox{otherwise}}) \\
&amp;&amp;\\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{write}}(\href{../exec/runtime.html#syntax-act}{\mathsf{wr}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast~\href{../exec/runtime.html#syntax-ord}{\mathsf{notears}}^?)   &amp; = &amp; \href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{write}}(\href{../exec/runtime.html#syntax-act}{\mathsf{rmw}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}_1}^\ast~{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}_2}^\ast) &amp; = &amp; {\href{../syntax/values.html#syntax-byte}{\mathit{byte}}_2}^\ast \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{write}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})  &amp; = &amp; \epsilon \qquad (\mathrel{\mbox{otherwise}}) \\
&amp;&amp;\\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{offset}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})   &amp; = &amp; \href{../syntax/values.html#syntax-int}{\mathit{u32}}  \qquad (\mathrel{\mbox{if}}~\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}) = \href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}]) \\
&amp;&amp;\\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{sync}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_1,\href{../exec/runtime.html#syntax-act}{\mathit{act}}_2)     &amp; = &amp; (\href{../exec/relaxed.html#relaxed-aux}{\mathrm{same}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_1,\href{../exec/runtime.html#syntax-act}{\mathit{act}}_2) \wedge \\
&amp;&amp; \qquad \href{../exec/relaxed.html#relaxed-aux}{\mathrm{ord}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_1) = \href{../exec/relaxed.html#relaxed-aux}{\mathrm{ord}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_2) = \href{../exec/runtime.html#syntax-ord}{\mathsf{seqcst}}) \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{range}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})    &amp; = &amp; [\href{../syntax/values.html#syntax-int}{\mathit{u32}} \ldots \href{../syntax/values.html#syntax-int}{\mathit{u32}} + n - 1] \\
 &amp;&amp;  (\mathrel{\mbox{if}}~\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}) = \href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}] \wedge \\
 &amp;&amp; \quad n = \mathrm{max}(|\href{../exec/relaxed.html#relaxed-aux}{\mathrm{read}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})|,|\href{../exec/relaxed.html#relaxed-aux}{\mathrm{write}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})|)) \\
&amp;&amp;\\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{tearfree}}(\href{../exec/runtime.html#syntax-act}{\mathsf{rd}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast)    &amp; = &amp; \bot \qquad (\mathrel{\mbox{if}}~\href{../exec/runtime.html#syntax-ord}{\mathit{ord}} = \href{../exec/runtime.html#syntax-ord}{\mathsf{unord}} \vee \href{../exec/runtime.html#syntax-ord}{\mathit{ord}} = \href{../exec/runtime.html#syntax-ord}{\mathsf{init}}) \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{tearfree}}(\href{../exec/runtime.html#syntax-act}{\mathsf{wr}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast)    &amp; = &amp; \bot \qquad (\mathrel{\mbox{if}}~\href{../exec/runtime.html#syntax-ord}{\mathit{ord}} = \href{../exec/runtime.html#syntax-ord}{\mathsf{unord}} \vee \href{../exec/runtime.html#syntax-ord}{\mathit{ord}} = \href{../exec/runtime.html#syntax-ord}{\mathsf{init}}) \\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{tearfree}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})    &amp; = &amp; \top \qquad (\mathrel{\mbox{otherwise}}) \\
&amp;&amp;\\
\href{../exec/relaxed.html#relaxed-aux}{\mathrm{id}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})     &amp; = &amp; \href{../exec/runtime.html#syntax-act}{\mathit{act}} \\
\end{array}\end{split}\]</div>
<p>The above operations on <a class="reference internal" href="runtime.html#syntax-act"><span class="std std-ref">actions</span></a> are raised to operations on <a class="reference internal" href="runtime.html#syntax-evt"><span class="std std-ref">events</span></a>, indexed by <a class="reference internal" href="runtime.html#syntax-reg"><span class="std std-ref">region</span></a>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
\mathit{func}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_1^\ast~\href{../exec/runtime.html#syntax-act}{\mathit{act}}~\href{../exec/runtime.html#syntax-act}{\mathit{act}}_2^\ast~\href{../exec/runtime.html#syntax-time}{\mathbin{\mathsf{at}}}~\href{../exec/runtime.html#syntax-time}{\mathit{time}}_p~\href{../exec/runtime.html#syntax-time}{\mathit{time}}) &amp; = &amp; \mathit{func}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}) \\
  &amp;&amp;  (\mathrel{\mbox{if}}~\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}) = \href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}])  \\
\mathit{func}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}_1^\ast~\href{../exec/runtime.html#syntax-act}{\mathit{act}}~\href{../exec/runtime.html#syntax-act}{\mathit{act}}_2^\ast~\href{../exec/runtime.html#syntax-time}{\mathbin{\mathsf{at}}}~\href{../exec/runtime.html#syntax-time}{\mathit{time}}_p~\href{../exec/runtime.html#syntax-time}{\mathit{time}},  \quad &amp;&amp;\\
\qquad \href{../exec/runtime.html#syntax-act}{\mathit{act}}_3^\ast~\href{../exec/runtime.html#syntax-act}{\mathit{act}}'~\href{../exec/runtime.html#syntax-act}{\mathit{act}}_4^\ast~\href{../exec/runtime.html#syntax-time}{\mathbin{\mathsf{at}}}~\href{../exec/runtime.html#syntax-time}{\mathit{time}}'_p~\href{../exec/runtime.html#syntax-time}{\mathit{time}}') &amp; = &amp; \mathit{func}(\href{../exec/runtime.html#syntax-act}{\mathit{act}},\href{../exec/runtime.html#syntax-act}{\mathit{act}}') \\
  &amp;&amp; (\mathrel{\mbox{if}}~\href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}) = \href{../exec/relaxed.html#relaxed-aux}{\mathrm{loc}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}}') = \href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}])  \\
\end{array}\end{split}\]</div>
</section>
<section id="traces">
<span id="relaxed-trace"></span><h2>Traces<a class="headerlink" href="#traces" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>novel notation here?</p>
</div>
<p>A trace is a coinductive list of <a class="reference internal" href="runtime.html#syntax-evt"><span class="std std-ref">events</span></a>. A trace is considered to be a <em>pre-execution</em> of a given <a class="reference internal" href="runtime.html#syntax-config"><span class="std std-ref">global configuration</span></a> if it represents the events emitted by the coinductive closure of the <a class="reference internal" href="runtime.html#syntax-reduction"><span class="std std-ref">global reduction relation</span></a> on that configuration, such that all of the trace’s consituent events have unique <a class="reference internal" href="runtime.html#syntax-time"><span class="std std-ref">time stamps</span></a> that are totally ordered according to the reduction order.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{c}
  \begin{array}{c}\href{../exec/runtime.html#syntax-config}{\mathit{config}} \href{../exec/conventions.html#formal-notation}{\hookrightarrow}^{\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}} \href{../exec/runtime.html#syntax-config}{\mathit{config}}' \qquad \vdash \href{../exec/runtime.html#syntax-config}{\mathit{config}}' : \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \\ \forall \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}' \in \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}, \href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}') \href{../exec/runtime.html#relaxed-prectot}{\mathrel{\prec_{\mathsf{tot}}}} \href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}})\end{array} \qquad \begin{array}{l}\href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}) \notin \href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}^\ast(\href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}) \\ \href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}_p(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}) \notin \href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}_p^\ast(\href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}})\end{array} \\[0.2ex]
  \hline \\[-0.8ex]
  \hline \\[-0.8ex]
  \vdash \href{../exec/runtime.html#syntax-config}{\mathit{config}} : \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}~\href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}
\end{array}\end{split}\]</div>
<p>When a WebAssembly program is executed, all behaviours observed during that execution must correspond to a single <a class="reference internal" href="#relaxed-consistent"><span class="std std-ref">consistent</span></a> pre-execution of that execution’s starting <a class="reference internal" href="runtime.html#syntax-config"><span class="std std-ref">configuration</span></a>.</p>
</section>
<section id="consistency">
<span id="relaxed-consistent"></span><h2>Consistency<a class="headerlink" href="#consistency" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[\frac{
  \forall \href{../exec/runtime.html#syntax-reg}{\mathit{reg}},~ \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}} \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{consistent-with}}}
}{
  \vdash \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{consistent}}}
}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{
  \begin{array}[b]{&#64;{}c&#64;{}}
    \forall i, \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{suspensions-consistent}}} \\
    \forall \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R \in \href{../exec/relaxed.html#relaxed-aux}{\mathrm{reading}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}), \exists \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W^\ast,
      \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{reads-each-from}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W^\ast \\
    \forall \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_I, \href{../exec/runtime.html#syntax-evt}{\mathit{evt}} \in \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}, \,
      \href{../exec/relaxed.html#relaxed-aux}{\mathrm{ord}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_I) = \href{../exec/runtime.html#syntax-ord}{\mathsf{init}} \wedge
      \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_I \neq \href{../exec/runtime.html#syntax-evt}{\mathit{evt}} \wedge
      \href{../exec/relaxed.html#relaxed-aux}{\mathrm{overlap}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_I, \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}) \Rightarrow \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_I \href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}
  \end{array}
}{
  \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}} \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{consistent-with}}}
}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{
  \begin{array}[b]{&#64;{}c&#64;{}}
    \left|\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W^\ast\right| = |\href{../exec/relaxed.html#relaxed-aux}{\mathrm{read}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R)| \\
    \forall i &lt; |\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W^\ast|,
      \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{reads-from}}}~\left(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W^\ast[i]\right)
    \\
    \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{no-tear}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W^\ast
  \end{array}
}{
  \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{reads-each-from}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W^\ast
}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{
  \begin{array}[b]{&#64;{}c}
    \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R \neq \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W  \\
    \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W \in \href{../exec/relaxed.html#relaxed-aux}{\mathrm{writing}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}) \\
    \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^{i,k} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{value-consistent}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W \\
    \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^k \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{hb-consistent}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W \\
    \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{sc-last-visible}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}^\ast_W
  \end{array}
}{
  \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{reads-from}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W
}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{
   \begin{array}[b]{&#64;{}r&#64;{~}c&#64;{~}l&#64;{}}
     \href{../exec/relaxed.html#relaxed-aux}{\mathrm{read}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R)[i] &amp;=&amp; \href{../exec/relaxed.html#relaxed-aux}{\mathrm{write}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W)[j] \\
     k = \href{../exec/relaxed.html#relaxed-aux}{\mathrm{offset}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R) + i &amp;=&amp; \href{../exec/relaxed.html#relaxed-aux}{\mathrm{offset}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W) + j
   \end{array}
}{
   \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^{i,k} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{value-consistent}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W
}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{
  \begin{array}[b]{&#64;{}c}
    \neg (\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R \href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W) \\
    \href{../exec/relaxed.html#relaxed-aux}{\mathrm{sync}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W, \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R) \Rightarrow \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W \href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R \\
    \forall \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'_W \in \href{../exec/relaxed.html#relaxed-aux}{\mathrm{writing}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}), \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W \href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'_W \href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R \Rightarrow k \notin \href{../exec/relaxed.html#relaxed-aux}{\mathrm{range}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'_W)
 \end{array}
}{
 \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^k \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{hb-consistent}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W
}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{
  \begin{array}[b]{&#64;{}l&#64;{\qquad}l&#64;{}}
    \forall \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'_W \in \href{../exec/relaxed.html#relaxed-aux}{\mathrm{writing}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}), \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W \href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R \Rightarrow \\
    \quad \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W \href{../exec/runtime.html#relaxed-prectot}{\mathrel{\prec_{\mathsf{tot}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'_W \href{../exec/runtime.html#relaxed-prectot}{\mathrel{\prec_{\mathsf{tot}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R \wedge \href{../exec/relaxed.html#relaxed-aux}{\mathrm{sync}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W, \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R) \Rightarrow \neg \href{../exec/relaxed.html#relaxed-aux}{\mathrm{sync}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'_W, \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R) \\
    \quad \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W \href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'_W \href{../exec/runtime.html#relaxed-prectot}{\mathrel{\prec_{\mathsf{tot}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R  \Rightarrow \neg\href{../exec/relaxed.html#relaxed-aux}{\mathrm{sync}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'_W, \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R) \\
    \quad \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W \href{../exec/runtime.html#relaxed-prectot}{\mathrel{\prec_{\mathsf{tot}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'_W \href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R \Rightarrow \neg\href{../exec/relaxed.html#relaxed-aux}{\mathrm{sync}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W, \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'_W)
  \end{array}
}{
  \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}} \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{sc-last-visible}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W
}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{
  \begin{array}[b]{l&#64;{}}
    \href{../exec/relaxed.html#relaxed-aux}{\mathrm{tearfree}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R) \Rightarrow \\
     \quad  |\{\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W \in \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W^\ast ~|~ \href{../exec/relaxed.html#relaxed-aux}{\mathrm{same}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R, \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W) \wedge \href{../exec/relaxed.html#relaxed-aux}{\mathrm{tearfree}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W)\}| \leq 1
  \end{array}
}{
  \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_R~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{no-tear}}}~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_W^\ast
}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{
  \begin{array}{c}\href{../exec/relaxed.html#relaxed-aux}{\mathrm{susp}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^\ast(i, \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}) = \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}' \qquad \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}'~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{suspensions-consistent-with}}}(\epsilon) \\ \forall \href{../exec/runtime.html#syntax-evt}{\mathit{evt}},\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}' \in \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}',~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}} \href{../exec/runtime.html#relaxed-prectot}{\mathrel{\prec_{\mathsf{tot}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}' \Longrightarrow \href{../exec/runtime.html#syntax-evt}{\mathit{evt}} \href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}'\end{array}
}{
  \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{suspensions-consistent}}}
}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\frac{
}{
  \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \epsilon~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{suspensions-consistent-with}}}(\href{../exec/runtime.html#syntax-time}{\mathit{time}}^\ast)
}\]</div>
<div class="math notranslate nohighlight">
\[\frac{
  \href{../exec/relaxed.html#relaxed-aux}{\mathrm{id}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}) = (\href{../exec/runtime.html#syntax-act}{\mathsf{wait}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[i]~\href{../syntax/values.html#syntax-int}{\mathit{s64}}) \qquad \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{suspensions-consistent-with}}}(\href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}})~\href{../exec/runtime.html#syntax-time}{\mathit{time}}^\ast)
}{
  \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}~\href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{suspensions-consistent-with}}}(\href{../exec/runtime.html#syntax-time}{\mathit{time}}^\ast)
}\]</div>
<div class="math notranslate nohighlight">
\[\frac{
  \href{../exec/relaxed.html#relaxed-aux}{\mathrm{id}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}) = (\href{../exec/runtime.html#syntax-act}{\mathsf{timeout}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[i]) \qquad \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{suspensions-consistent-with}}}(\href{../exec/runtime.html#syntax-time}{\mathit{time}}^\ast~\href{../exec/runtime.html#syntax-time}{\mathit{time}}'^\ast)
}{
  \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}~\href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{suspensions-consistent-with}}}(\href{../exec/runtime.html#syntax-time}{\mathit{time}}^\ast~\href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}_p(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}})~\href{../exec/runtime.html#syntax-time}{\mathit{time}}'^\ast)
}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{
  \begin{array}{c}\href{../exec/relaxed.html#relaxed-aux}{\mathrm{id}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^n(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}^n) = (\href{../exec/runtime.html#syntax-act}{\mathsf{woken}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[i]) \qquad \href{../exec/relaxed.html#relaxed-aux}{\mathrm{id}}_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_N) = (\href{../exec/runtime.html#syntax-act}{\mathsf{notify}}~\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}[i]~n~k) \\ n &lt; k \Longrightarrow m = 0 \qquad \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{suspensions-consistent-with}}}(\href{../exec/runtime.html#syntax-time}{\mathit{time}}^m)\end{array}
}{
  \vdash_{\href{../exec/runtime.html#syntax-reg}{\mathit{reg}}}^i \href{../exec/runtime.html#syntax-evt}{\mathit{evt}}_N~\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}^n~\href{../exec/relaxed.html#relaxed-trace}{\mathit{tr}}~\href{../exec/relaxed.html#relaxed-consistent}{\mathrel{\mbox{suspensions-consistent-with}}}(\href{../exec/runtime.html#syntax-time}{\mathit{time}}^m~\href{../exec/relaxed.html#relaxed-aux}{\mathrm{time}}_p^n(\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}^n))
}\end{split}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following is a non-normative and non-exhaustive explanation of WebAssembly’s relaxed memory model in plain English. Note that the definition of <a class="reference internal" href="#relaxed-consistent"><span class="std std-ref">Consistency</span></a> is the sole normative definition of the relaxed memory model.</p>
<p>When a WebAssembly operation reads from shared mutable state, the WebAssembly relaxed memory model determines the value that this read access <em>observes</em>, in terms of the write access to the same location(s) that have occurred in the execution.</p>
<p>The WebAssembly memory model is built around the concept of a <em>happens-before</em> transitive partial order between accesses of shared mutable state, <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span>, which captures a strong notion of causality. All sequential accesses in the same thread are related by <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span> according to execution order. Certain operations also establish a <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span> relation between operations of different threads (see <em>atomic</em> accesses below). A read access may never take its value from a write access that comes later in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span>. Moreover, if two write accesses ordered by <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span> come before a read access in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span>, the read access must take its value from the later of the two write accesses according to <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span>. In the case that <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span> does not uniquely determine a write access that a given read access <em>must</em> take its value from, the read access may non-deterministically take its value from any permitted write.</p>
<p>In the case that a read operation is a multi-byte memory access, the value of each byte may in certain circumstances be determined by a different write event. If this happens, we describe the read operation as <em>tearing</em>. In general, naturally aligned multi-byte reads are not allowed to tear, unless they race with a partially overlapping write or are greater than four bytes in width.</p>
<p>Most WebAssembly accesses of shared mutable state are classified as <em>non-atomic</em>. However a number of operations are classified as performing <em>atomic</em> accesses. Atomic accesses must always be naturally aligned. If an atomic read takes its value from an atomic write of the same width, the write access is fixed as coming before the read access in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span>. This is the main mechanism by which a <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span> relation is established between threads.</p>
<p>WebAssembly’s atomic operations are also required to be <em>sequentially consistent</em>. The relaxed memory model defines a toal order on all events of the execution, <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prectot}{\mathrel{\prec_{\mathsf{tot}}}}\)</span>, and sequentially consistent operations to identical ranges must respect this ordering - i.e. sequentially consistent reads cannot read from any sequentially consistent write of idential range other than the most recent preceding one according to <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prectot}{\mathrel{\prec_{\mathsf{tot}}}}\)</span>.</p>
<p>Some operations such as memory accesses must perform a bounds check in addition to accessing data. The relaxed memory model treats these accesses as additionally accessing a distinguished <em>length</em> location, with the observed value respecting the constraints of the relaxed memory model. Most bounds checks are non-atomic, but bounds checks peformed during <a class="reference internal" href="modules.html#exec-instantiation"><span class="std std-ref">instantiation</span></a> are atomic, and changes to the length (e.g. <span class="math notranslate nohighlight">\(\href{../syntax/instructions.html#syntax-instr-memory}{\mathsf{memory.grow}}\)</span>) are modelled as atomic read-modify-write accesses.</p>
<p>In some circumstances, two accesses to overlapping locations may occur in an execution without any relation in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span>. This situation is known as a <em>race</em>. If at least one of these accesses is a non-atomic write, we describe this situation as a <em>data race</em>. Unlike some other relaxed memory models, WebAssembly does not declare data races to be undefined behaviour. However, the allowed execution behaviours may still be highly non-deterministic as the lack of <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span> relations means that reads participating in or overlapping with the location of the data race may non-deterministically observe a number of different values.</p>
<p>The relaxed memory model also describes the concurrent behaviour of WebAssembly’s wait (<span class="math notranslate nohighlight">\(\href{../syntax/instructions.html#syntax-instr-atomic-memory}{\mathsf{memory.atomic.wait}}\)</span>) and notify (<span class="math notranslate nohighlight">\(\href{../syntax/instructions.html#syntax-instr-atomic-memory}{\mathsf{memory.atomic.notify}}\)</span>) operations. Each memory location is associated with a queue of waiting threads. A thread suspending as the result of a wait operation enters the queue, and a notify operation to that location will attempt to wake up as many threads as possible from the head of the associated queue, up to the maximum specified by the arguments of the notify operation. All operations on the same location which change the state of that location’s wait queue are sequentially consistent and totally ordered by <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}}\)</span>.</p>
</div>
<dl class="footnote brackets">
<dt class="label" id="cite-oopsla2019"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>The semantics of the relaxed memory model is derived from the following article:
Conrad Watt, Andreas Rossberg, Jean Pichon-Pharabod. <a class="reference external" href="https://dl.acm.org/citation.cfm?id=3360559">Weakening WebAssembly</a>. Proceedings of the ACM on Programming Languages (OOPSLA 2019). ACM 2019.</p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, WebAssembly Community Group.
      
    </div>

    

    
  </body>
</html>